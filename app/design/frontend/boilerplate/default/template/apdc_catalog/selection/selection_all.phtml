<?php
	$collection = $this->getAllSelections();
	//$nbSelection = $collection->count();
?>
<?php if($collection['count'] > 0) :?>
<div class="row apdc_home_selection">
	<div class="col-xs-12">
	    <div class="block-promos text-center container">
	        <div class="border-container"></div>
	    	<div class="inner-box">
                <h2 class="title-block"><?php echo $this->__('En ce moment chez vos commerÃ§ants'); ?></h2>
			    <div class="colored-line"></div>
				<div id="carrousel-selection-home-row1" class="owl-carousel apdc-products-grid">
					<?php
						foreach($collection['row1'] as $selection):
							$productUrl = $selection->getProductUrl();
							$strippedName = $this->stripTags($selection->getName(), null, true);
							$imageLabel = $this->stripTags($this->getImageLabel($selection, 'small_image'), null, true);
							echo '<div class="product-info row item">' ;
							?>
								<form class="col-md-12" action="<?php echo $productUrl; ?>"
									  method="post"
									  class="product-item-info apdc-add-to-cart-form product_addtocart_form_<?php echo $selection['product_id']; ?>"
									  id="product_addtocart_form_<?php echo $selection->getId(); ?>"
									  data-product-id="<?php echo $selection->getId(); ?>">

									<a href="<?php echo $productUrl; ?>"
									   title="<?php echo $strippedName; ?>"
									   class="show-product-popup product-image"
									   data-ajax-product-popup="<?php echo $this->getUrl('catalog/product/ajaxQuickView', array('form_key' => Mage::getSingleton('core/session')->getFormKey())); ?>">

										<img src="<?= $this->helper('catalog/image')->init($selection, 'small_image')->resize(200, 125)?>" width="200" height="125" alt="<?php echo $imageLabel; ?>" title="<?php echo $imageLabel; ?>" />
										<?php echo $this->getChild('product_labels')->setData('product', $selection)->toHtml(); ?>
									</a>
									<div class="product-info">
										<a href="<?php echo $productUrl; ?>"
										   title="<?php echo $strippedName; ?>"
										   class="show-product-popup"
										   data-ajax-product-popup="<?php echo $this->getUrl('catalog/product/ajaxQuickView', array('form_key' => Mage::getSingleton('core/session')->getFormKey())); ?>">
											<h3 class="product-name"><?= $selection->getName()?></h3>
										</a>
										<p class="product-portion"><?php echo $selection->getData('short_description'); ?></p>
										<!--<p class="product-commercant-name">
											<?php echo Mage::getResourceSingleton('catalog/product')
													->getAttribute('commercant')
													->getSource()
													->getOptionText($selection->getData('commercant')); ?>
										</p>-->
										<div class="bottom">
										    <?php echo $this->getPriceHtml($selection, true) ?>
                                            <?php if($selection->getData('prix_kilo_site')) :?>
                                                <div class="product-short_desc">
                                                    <?php echo $selection->getData('prix_kilo_site'); ?>
                                                </div>
                                            <?php endif; ?>
                                            <div class="actions">
                                                <div class="action-group">
                                                    <div>
                                                        <a title="<?php echo $this->quoteEscape($this->__('Ajouter')) ?>" class="button button-green btn-cart show-product-popup" href="<?php echo $selection->getProductUrl() ?>" data-ajax-product-popup="<?php echo $this->getUrl('catalog/product/ajaxQuickView', array('form_key' => Mage::getSingleton('core/session')->getFormKey())); ?>"><i class="fa fa-cart-plus"></i> <?php echo $this->__('Ajouter') ?></a>
                                                    </div>
                                                </div>
                                            </div>
										</div>
									</div>
								</form>
							<?php
							echo '</div>' ;
						endforeach;
					?>
				</div>
				<div id="carrousel-selection-home-row2" class="owl-carousel apdc-products-grid">
					<?php
						foreach($collection['row2'] as $selection):
							$productUrl = $selection->getProductUrl();
							$strippedName = $this->stripTags($selection->getName(), null, true);
							$imageLabel = $this->stripTags($this->getImageLabel($selection, 'small_image'), null, true);
							echo '<div class="product-info row item">' ;
							?>
								<form class="col-md-12" action="<?php echo $productUrl; ?>"
									  method="post"
									  class="product-item-info apdc-add-to-cart-form product_addtocart_form_<?php echo $selection['product_id']; ?>"
									  id="product_addtocart_form_<?php echo $selection->getId(); ?>"
									  data-product-id="<?php echo $selection->getId(); ?>">

									<a href="<?php echo $productUrl; ?>"
									   title="<?php echo $strippedName; ?>"
									   class="show-product-popup product-image"
									   data-ajax-product-popup="<?php echo $this->getUrl('catalog/product/ajaxQuickView', array('form_key' => Mage::getSingleton('core/session')->getFormKey())); ?>">

										<img src="<?= $this->helper('catalog/image')->init($selection, 'small_image')->resize(200, 125)?>" width="200" height="125" alt="<?php echo $imageLabel; ?>" title="<?php echo $imageLabel; ?>" />
										<?php echo $this->getChild('product_labels')->setData('product', $selection)->toHtml(); ?>
									</a>
									<div class="product-info">
										<a href="<?php echo $productUrl; ?>"
										   title="<?php echo $strippedName; ?>"
										   class="show-product-popup"
										   data-ajax-product-popup="<?php echo $this->getUrl('catalog/product/ajaxQuickView', array('form_key' => Mage::getSingleton('core/session')->getFormKey())); ?>">
											<h3 class="product-name"><?= $selection->getName()?></h3>
										</a>
										<p class="product-portion"><?php echo $selection->getData('short_description'); ?></p>
										<!--<p class="product-commercant-name">
											<?php echo Mage::getResourceSingleton('catalog/product')
													->getAttribute('commercant')
													->getSource()
													->getOptionText($selection->getData('commercant')); ?>
										</p>-->
										<div class="bottom">
										    <?php echo $this->getPriceHtml($selection, true) ?>
                                            <?php if($selection->getData('prix_kilo_site')) :?>
                                                <div class="product-short_desc">
                                                    <?php echo $selection->getData('prix_kilo_site'); ?>
                                                </div>
                                            <?php endif; ?>
                                            <div class="actions">
                                                <div class="action-group">
                                                    <div>
                                                        <a title="<?php echo $this->quoteEscape($this->__('Ajouter')) ?>" class="button button-green btn-cart show-product-popup" href="<?php echo $selection->getProductUrl() ?>" data-ajax-product-popup="<?php echo $this->getUrl('catalog/product/ajaxQuickView', array('form_key' => Mage::getSingleton('core/session')->getFormKey())); ?>"><i class="fa fa-cart-plus"></i> <?php echo $this->__('Ajouter') ?></a>
                                                    </div>
                                                </div>
                                            </div>
										</div>
									</div>
								</form>
							<?php
							echo '</div>' ;
						endforeach;
					?>
				</div>
				<div class="owl-buttons">
				    <a href="#" class="prev"><i class="fa fa-angle-left"></i></a>
				    <a href="#" class="next"><i class="fa fa-angle-right"></i></a>
				</div>
		    </div>
	    </div>
	</div>
</div>
<script>
    $j(document).ready(function() {
		
		var optionsOwlCarouselSelectionHome = {
			slideBy: 'page',
			items:8,
			autoPlay : false,
			loop: true,
			slideSpeed : 800,
			responsive: {
				0:{
					items:1,
					slideBy: 1,
				},
                500:{
					items:2,
					slideBy: 2,
				},
                740:{
					items:4,
					slideBy: 4,
				},
				980:{
					items:6,
					slideBy: 6,
				},
				1200:{
					items:8,
					slideBy: 8,
				}
			}	
		};
		
		var owlCarouselSelectionHomeRow1 = $j("#carrousel-selection-home-row1").owlCarousel(optionsOwlCarouselSelectionHome);
		var owlCarouselSelectionHomeRow2 = $j("#carrousel-selection-home-row2").owlCarousel(optionsOwlCarouselSelectionHome);
		
		$j(".prev").click(function (evt) {
			evt.preventDefault();
			owlCarouselSelectionHomeRow1.trigger('prev.owl.carousel');
			owlCarouselSelectionHomeRow2.trigger('prev.owl.carousel');
		});

		$j(".next").click(function (evt) {
			evt.preventDefault();
			owlCarouselSelectionHomeRow1.trigger('next.owl.carousel');
			owlCarouselSelectionHomeRow2.trigger('next.owl.carousel');
		});
		
    });
</script>
<?php endif;?>
